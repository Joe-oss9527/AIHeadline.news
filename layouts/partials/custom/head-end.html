{{/* 时间本地化脚本 - 在 head 中立即执行，消除闪烁 */}}
<script>
(function(){
  'use strict';

  // 时间本地化函数
  function localizeTimestamps() {
    const timeElements = document.querySelectorAll('time.local-time[datetime]');

    timeElements.forEach(timeEl => {
      const isoString = timeEl.getAttribute('datetime');
      if (!isoString) return;

      try {
        const date = new Date(isoString);
        const lang = document.documentElement.lang || 'zh-CN';

        // 根据语言格式化时间
        if (lang.startsWith('zh')) {
          // 中文格式：2025年10月13日 07:53:40
          const formatter = new Intl.DateTimeFormat(lang, {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
            hour12: false
          });

          const parts = formatter.formatToParts(date);
          const year = parts.find(p => p.type === 'year').value;
          const month = parts.find(p => p.type === 'month').value;
          const day = parts.find(p => p.type === 'day').value;
          const hour = parts.find(p => p.type === 'hour').value;
          const minute = parts.find(p => p.type === 'minute').value;
          const second = parts.find(p => p.type === 'second').value;

          timeEl.textContent = `${year}年${month}月${day}日 ${hour}:${minute}:${second}`;
        } else {
          // 其他语言使用标准格式
          const formatter = new Intl.DateTimeFormat(lang, {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
            hour12: false
          });
          timeEl.textContent = formatter.format(date);
        }

        // 设置 title 属性为完整的本地化时间
        const longFormatter = new Intl.DateTimeFormat(lang, {
          dateStyle: 'full',
          timeStyle: 'long'
        });
        timeEl.setAttribute('title', longFormatter.format(date));

        // 添加 localized 类以触发淡入动画
        timeEl.classList.add('localized');
      } catch (e) {
        console.error('Error parsing timestamp:', isoString, e);
      }
    });
  }

  // 立即执行（处理已加载的元素）
  if (document.readyState === 'loading') {
    // 如果 DOM 还在加载，等待 DOMContentLoaded
    document.addEventListener('DOMContentLoaded', localizeTimestamps);
  } else {
    // DOM 已经加载完成，立即执行
    localizeTimestamps();
  }
})();
</script>
